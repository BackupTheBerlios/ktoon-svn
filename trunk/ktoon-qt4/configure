#/bin/bash

. scripts/global

CONFIGURE_TEST_DIR=configure.tests
FAIL=-1
SUCC=0
CONFIG_H=config.h
CONFIG_LOG=$(pwd)/$LOG_FILE

# $1 parameter is a text
# $2 directory 
function check()
{
	RESULT="yes."
	if [ -d $CONFIGURE_TEST_DIR/$2 ]
	then
		cd $CONFIGURE_TEST_DIR/$2
		$QMAKE 2>> $CONFIG_LOG >> $CONFIG_LOG
		${MAKE} 2>>$CONFIG_LOG >>$CONFIG_LOG || RESULT="no."
		cd - 2>> /dev/null >> /dev/null
	else
		RESULT="no."
	fi
	
	qpinfo "Checking for $1... \t$RESULT" -n
	
	if [ ${RESULT} != "yes." ]
	then
		return $FAIL
	fi
	
	return $SUCC
}

function defineMacro()
{
	echo "#define $1" >> $CONFIG_H
}

detectQtVersion

echo "/* Generated automatically by configure script */" > $CONFIG_H 
ln -fs $(pwd)/$CONFIG_H $(pwd)/src/lib/$CONFIG_H

LIBS=''

check "sound" sound && LIBS="$LIBS -laudio" && defineMacro HAVE_SOUND
check "gif" gif && LIBS="$LIBS -lgif" && defineMacro HAVE_LIBGIF
check "ffmpeg" ffmpeg && LIBS="$LIBS -lavcodec -lavformat" && defineMacro HAVE_FFMPEG
check "ming" ming && LIBS="$LIBS -lming" && defineMacro HAVE_MING

if [ "$LIBS" != '' ]
then
	echo "LIBS += $LIBS" > $KT_CONFIG
else
	echo > $KT_CONFIG
fi

echo
echo "**************************************"
qpwarn "$APPNAME is configured"
echo "**************************************"
echo

