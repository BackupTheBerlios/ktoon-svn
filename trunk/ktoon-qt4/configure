#/bin/bash

. scripts/global

CONFIGURE_TEST_DIR=configure.tests
FAIL=-1
SUCC=0
CONFIG_H=config.h
CONFIG_LOG=$(pwd)/$LOG_FILE

# $1 parameter is a text
# $2 directory 
function check()
{
	RESULT="yes."
	if [ -d $CONFIGURE_TEST_DIR/$2 ]
	then
		cd $CONFIGURE_TEST_DIR/$2
		$QMAKE 2>> $CONFIG_LOG >> $CONFIG_LOG
		${MAKE} 2>>$CONFIG_LOG >>$CONFIG_LOG || RESULT="no."
		cd - 2>> /dev/null >> /dev/null
	else
		RESULT="no."
	fi
	
	qpinfo "Checking for $1... \t$RESULT" -n
	
	if [ ${RESULT} != "yes." ]
	then
		return $FAIL
	fi
	
	return $SUCC
}

function defineMacro()
{
	echo "#define $1" >> $CONFIG_H
}

detectQtVersion

echo "/* Generated automatically by configure script */" > $CONFIG_H 
ln -fs $(pwd)/$CONFIG_H $(pwd)/src/lib/$CONFIG_H

check "sound" sound && defineMacro HAVE_SOUND
check "gif" gif && defineMacro HAVE_LIBGIF
check "ungif" ungif && defineMacro HAVE_LIBUNGIF
check "ffmpeg" ffmpeg && defineMacro HAVE_FFMPEG
check "ming" ming && defineMacro HAVE_MING


echo
echo "**************************************"
qpwarn "$APPNAME is configured, if you want clean configure, please execute 'make confclean'"
echo "**************************************"
echo

